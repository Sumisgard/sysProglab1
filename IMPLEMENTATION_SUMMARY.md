# Реализация сервера распределенной памяти (Distributed Memory Server)

## Обзор

Реализация сервера распределенной памяти, совместимого с POSIX, предоставляющего функции `shmget`, `shmat`, `shmdt`, `shmctl` через сетевой протокол. Это позволяет использовать разделяемую память через сеть, как будто она локальная.

## Архитектура

### Серверная часть (`distributed_shm_server`)
- Принимает TCP-соединения на порту 8080 (по умолчанию)
- Поддерживает многопоточную обработку клиентов
- Использует `mmap` для создания сегментов разделяемой памяти
- Обрабатывает все основные операции с разделяемой памятью

### Клиентская библиотека (`distributed_shm_client`)
- Предоставляет POSIX-совместимый интерфейс
- Обрабатывает сетевое взаимодействие с сервером
- Поддерживает статическую и динамическую линковку

## Реализованные функции POSIX

### `shmget(key_t key, size_t size, int shmflg)`
- Создает или получает доступ к сегменту разделяемой памяти
- Поддерживает флаги `IPC_CREAT`, `IPC_EXCL`, `IPC_RMID`

### `shmat(int shmid, const void *shmaddr, int shmflg)`
- Присоединяет сегмент разделяемой памяти к адресному пространству процесса
- Возвращает указатель на сегмент

### `shmdt(const void *shmaddr)`
- Отсоединяет сегмент разделяемой памяти от адресного пространства процесса

### `shmctl(int shmid, int cmd, struct shmid_ds *buf)`
- Выполняет различные операции управления сегментом
- Поддерживает команды `IPC_STAT`, `IPC_SET`, `IPC_RMID`

## Протокол взаимодействия

### Команды:
- `CMD_CREATE_SEGMENT` - создание сегмента
- `CMD_ATTACH_SEGMENT` - присоединение к сегменту
- `CMD_DETACH_SEGMENT` - отсоединение от сегмента
- `CMD_REMOVE_SEGMENT` - удаление сегмента
- `CMD_READ_DATA` - чтение данных
- `CMD_WRITE_DATA` - запись данных
- `CMD_SHMCTL` - управление сегментом

### Структуры данных:
- `shm_header_t` - заголовок запроса
- `shm_response_t` - заголовок ответа
- Используется преобразование байтового порядка (network byte order)

## Обработка ошибок

Все функции корректно обрабатывают ошибки POSIX:
- `EINVAL` - недопустимый идентификатор или параметры
- `ENOMEM` - нехватка памяти
- `EACCES` - отсутствие прав доступа
- `ENOENT` - сегмент не существует

## Используемые инструменты и библиотеки

- **Системные вызовы POSIX**: `socket`, `bind`, `listen`, `accept`, `connect`
- **Сетевые функции**: `inet_pton`, `gethostbyname`, `htons`, `ntohs`
- **Функции синхронизации**: `pthread_mutex_lock/unlock`
- **Управление памятью**: `mmap`, `munmap`
- **Обработка сигналов**: `signal`

## Файлы проекта

- `distributed_shm.h` - общие определения протокола
- `distributed_shm_server.c` - реализация сервера
- `distributed_shm_client.h` - заголовочный файл клиентской библиотеки
- `distributed_shm_client.c` - реализация клиентской библиотеки
- `Makefile` - правила сборки
- `test_dshm.c` - тестовая программа
- `test_dshm_errors.c` - тест обработки ошибок
- `example_usage.c` - пример использования
- `README.md` - документация
- `IMPLEMENTATION_SUMMARY.md` - текущий файл

## Сборка и запуск

### Компиляция:
```bash
make all          # Сборка сервера и клиентской библиотеки
make server       # Сборка только сервера
make client       # Сборка только клиентской библиотеки
make test         # Сборка тестовой программы
make example      # Сборка примера
```

### Запуск:
```bash
# Запуск сервера
./distributed_shm_server [порт]

# Запуск тестов (предварительно запустив сервер)
LD_LIBRARY_PATH=. ./test_dshm
LD_LIBRARY_PATH=. ./test_dshm_errors
LD_LIBRARY_PATH=. ./example_usage
```

## Особенности реализации

1. **Полная POSIX-совместимость**: Все функции работают так же, как и стандартные функции разделяемой памяти
2. **Безопасность**: Проверка всех возвращаемых значений, обработка ошибок
3. **Переносимость**: Использование стандартных библиотечных функций, поддержка разных архитектур
4. **Многопоточность**: Безопасная обработка нескольких клиентов одновременно
5. **Сетевая прозрачность**: Клиент может не знать, что использует распределенную память

## Тестирование

Реализация была протестирована с использованием:
- Основного теста функциональности
- Теста обработки ошибок
- Примера использования всех функций

Все тесты прошли успешно, подтверждая корректность реализации.
